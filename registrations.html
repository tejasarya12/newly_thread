<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Directory | Support.AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;500;700&family=Manrope:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script>
        tailwind.config = { darkMode: 'class', theme: { extend: { colors: { dark: '#0a0a0a', light: '#F5F5F7', gold: '#D4AF37' }, fontFamily: { display: ['Oswald', 'sans-serif'], body: ['Manrope', 'sans-serif'] } } } }
    </script>
    <style>
        .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both infinite; }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }
        .ambient-bg {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: -1;
            background: radial-gradient(circle at 50% 50%, rgba(212, 175, 55, 0.05), transparent 70%);
            opacity: 0.6; transition: background 0.2s ease;
        }
    </style>
</head>
<body class="font-body bg-light dark:bg-dark text-gray-900 dark:text-white transition-colors duration-500">

    <div class="ambient-bg" id="ambientBg"></div>

    <button id="themeToggle" class="fixed top-6 right-6 z-[100] w-12 h-12 rounded-full border border-gray-200 dark:border-white/20 flex items-center justify-center hover:scale-110 transition-transform bg-white/20 dark:bg-black/20 backdrop-blur-md cursor-pointer">
        <svg class="w-5 h-5 dark:hidden text-gold" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
        <svg class="w-5 h-5 hidden dark:block text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
    </button>

    <nav class="fixed top-0 w-full z-50 bg-light/90 dark:bg-dark/90 backdrop-blur-md border-b border-gray-200 dark:border-white/5 px-8 py-5 flex justify-between items-center">
        <a href="/" class="text-xl font-display font-bold uppercase tracking-tighter hover:text-gold transition-colors">
            Support<span class="text-gold">.AI</span>
        </a>
        <div class="flex gap-4">
            <a href="/" class="text-[10px] font-bold uppercase tracking-[0.2em] px-4 py-2 hover:text-gold transition-colors">Home</a>
            <a href="/register" id="regBtn" class="text-[10px] font-bold uppercase tracking-[0.2em] border border-gray-300 dark:border-white/20 px-6 py-2 hover:bg-gold hover:text-black hover:border-gold transition-all duration-300">Register New</a>
            <button id="delModeBtn" class="text-[10px] font-bold uppercase tracking-[0.2em] text-red-500 border border-red-500/30 px-6 py-2 hover:bg-red-500 hover:text-white transition-all duration-300">Delete Data</button>
            <div id="deleteActions" class="hidden flex gap-2">
                <button id="cancelDelBtn" class="text-[10px] font-bold uppercase tracking-[0.2em] px-4 py-2 text-gray-500 hover:text-black dark:hover:text-white">Cancel</button>
                <button id="confirmDelBtn" class="text-[10px] font-bold uppercase tracking-[0.2em] bg-red-600 text-white px-6 py-2 hover:bg-red-700 transition-all">Delete Selected</button>
            </div>
        </div>
    </nav>

    <header class="pt-48 pb-20 px-6 text-center relative overflow-hidden">
        <div class="relative z-10">
            <h1 class="text-6xl md:text-8xl font-display font-bold uppercase mb-6 opacity-0 animate-title">The Roster</h1>
            <p class="text-gray-500 uppercase tracking-[0.3em] text-xs md:text-sm opacity-0 animate-title">Active Neural Networks</p>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-6 pb-32">
        <div id="companyGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
    </main>

    <script>
        document.addEventListener('mousemove', (e) => {
            const bg = document.getElementById('ambientBg');
            bg.style.background = `radial-gradient(circle at ${e.clientX}px ${e.clientY}px, rgba(212, 175, 55, 0.08), transparent 50%)`;
        });

        // Standard Logic (Load Grid, Toggle Delete) - Same as previous version but with Theme Toggle logic
        // ... (Keep the previous script logic for grid loading and deletion) ...
        // Ensure theme toggle works:
        const themeToggle = document.getElementById('themeToggle');
        const html = document.documentElement;
        if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) { html.classList.add('dark'); }
        themeToggle.addEventListener('click', () => { html.classList.toggle('dark'); localStorage.setItem('theme', html.classList.contains('dark') ? 'dark' : 'light'); });
        
        // ... (rest of logic: loadGrid, deleteMode, etc.) ...
        // Re-paste logic from previous response for completion if needed
        let deleteMode = false;
        let selectedCompanies = new Set();
        document.addEventListener('DOMContentLoaded', async () => {
            gsap.to(".animate-title", { opacity: 1, y: 0, stagger: 0.2, duration: 1.2, ease: "power2.out" });
            loadGrid();
        });
        async function loadGrid() {
            const grid = document.getElementById('companyGrid');
            try {
                const res = await fetch('/api/companies');
                const data = await res.json();
                if(data.status === 'success' && data.companies.length) {
                    grid.innerHTML = data.companies.map(c => `
                        <div class="company-card relative group bg-white dark:bg-[#0f0f0f] p-10 min-h-[300px] flex flex-col justify-between shadow-sm border border-gray-100 dark:border-white/5 cursor-pointer transition-all duration-300 hover:shadow-xl" data-name="${c.name}">
                            <div class="delete-overlay absolute top-4 right-4 hidden z-50"><input type="checkbox" class="w-6 h-6 accent-red-600 cursor-pointer pointer-events-none" onchange="toggleSelect('${c.name}', this)"></div>
                            <div class="relative z-30"><div class="text-6xl font-display font-bold text-gray-200 dark:text-white/10 group-hover:text-gold/20 transition-colors">${c.name.charAt(0).toUpperCase()}</div><h3 class="text-3xl font-display uppercase font-medium mt-auto mb-2 text-gray-900 dark:text-white group-hover:text-gold transition-colors">${c.name}</h3><p class="text-xs text-gray-500 font-mono uppercase tracking-wider">${c.product_name}</p></div>
                            <a href="/?company=${encodeURIComponent(c.name)}" class="absolute inset-0 z-10 card-link"></a>
                        </div>`).join('');
                }
            } catch (e) { grid.innerHTML = `<div class="text-center text-red-500">Error loading data</div>`; }
        }
        
        const delBtn = document.getElementById('delModeBtn');
        const regBtn = document.getElementById('regBtn');
        const actions = document.getElementById('deleteActions');
        const cancelBtn = document.getElementById('cancelDelBtn');
        const confirmBtn = document.getElementById('confirmDelBtn');

        delBtn.addEventListener('click', () => { deleteMode = true; toggleUI(); });
        cancelBtn.addEventListener('click', () => { deleteMode = false; selectedCompanies.clear(); toggleUI(); });
        confirmBtn.addEventListener('click', async () => {
            if(selectedCompanies.size === 0) return alert("Select at least one item.");
            if(!confirm(`Delete ${selectedCompanies.size} companies permanently?`)) return;
            confirmBtn.innerText = "DELETING...";
            try {
                const res = await fetch('/api/delete_companies', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({companies: Array.from(selectedCompanies)}) });
                const d = await res.json();
                if(d.status === 'success') { alert("Deleted."); window.location.reload(); }
            } catch(e) { alert("Error deleting."); }
        });

        function toggleUI() {
            if(deleteMode) {
                delBtn.classList.add('hidden'); regBtn.classList.add('hidden'); actions.classList.remove('hidden');
                document.querySelectorAll('.company-card').forEach(card => { card.classList.add('shake', 'border-red-500/30'); card.querySelector('.delete-overlay').classList.remove('hidden'); card.querySelector('.card-link').style.pointerEvents = 'none'; card.onclick = () => { const cb = card.querySelector('input'); cb.checked = !cb.checked; toggleSelect(card.dataset.name, cb); }; });
            } else {
                delBtn.classList.remove('hidden'); regBtn.classList.remove('hidden'); actions.classList.add('hidden');
                document.querySelectorAll('.company-card').forEach(card => { card.classList.remove('shake', 'border-red-500/30', 'bg-red-500/10'); card.querySelector('.delete-overlay').classList.add('hidden'); card.querySelector('input').checked = false; card.querySelector('.card-link').style.pointerEvents = 'auto'; card.onclick = null; });
            }
        }
        function toggleSelect(name, cb) {
            const card = cb.closest('.company-card');
            if(cb.checked) { selectedCompanies.add(name); card.classList.add('bg-red-500/10', 'border-red-500'); } else { selectedCompanies.delete(name); card.classList.remove('bg-red-500/10', 'border-red-500'); }
            confirmBtn.innerText = `Delete (${selectedCompanies.size})`;
        }
    </script>
</body>
</html>
